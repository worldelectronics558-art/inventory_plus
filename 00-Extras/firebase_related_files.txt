// src/firebase/firebase-config.js
import { initializeApp } from "firebase/app";
import { getFirestore } from "firebase/firestore";
// IMPORTANT: Include the necessary auth methods
import { getAuth } from "firebase/auth"; 

// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyC0Umv5ZJwCaTjFp2yK6OiUeVve8RHqbz8",
    authDomain: "inventoryplus-a2439.firebaseapp.com",
    projectId: "inventoryplus-a2439",
    storageBucket: "inventoryplus-a2439.firebasestorage.app",
    messagingSenderId: "654840001369",
    appId: "1:654840001369:web:21627f25806cc8a4059248"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize services
export const db = getFirestore(app);
export const auth = getAuth(app); 

// REMOVED: The initialAuth function previously used for anonymous login is now gone.


// src/firebase.js
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';
import { getAuth, signInWithCustomToken, signInAnonymously } from 'firebase/auth';

// 1. Get configuration from the global environment variables
const FIREBASE_CONFIG = window.__firebase_config;
const INITIAL_AUTH_TOKEN = window.__initial_auth_token;

// 2. Initialize Firebase App
const app = initializeApp(FIREBASE_CONFIG);

// 3. Initialize services
const db = getFirestore(app);
const auth = getAuth(app);

// 4. Authentication Logic
async function initialAuth() {
  try {
    if (INITIAL_AUTH_TOKEN) {
      // Preferred method: Use the provided custom token
      const userCredential = await signInWithCustomToken(auth, INITIAL_AUTH_TOKEN);
      return userCredential.user.uid;
    } else {
      // Fallback: Use anonymous sign-in if no token is available
      const userCredential = await signInAnonymously(auth);
      return userCredential.user.uid;
    }
  } catch (error) {
    console.error("Firebase Authentication failed:", error);
    // In a real app, you would show an error screen here
    return null;
  }
}

export { db, auth, initialAuth, app };



